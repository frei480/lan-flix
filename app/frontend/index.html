<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Video Player</title>
    <link rel="stylesheet" href="/style.css"> <!-- Если добавите style.css -->
</head>
<body>
    <h1>Local Video Service</h1>

    <button onclick="scanAndLoadVideos()">Scan and Load Videos</button>
    <p>This will scan the 'videos' and 'transcriptions' folders and update the database.</p>

    <h2>Search Videos</h2>
    <input type="text" id="search-input" placeholder="Enter search query">
    <button onclick="searchVideos()">Search</button>
    <div id="search-results"></div>

    <h2>Available Videos</h2>
    <div id="video-list"></div>

    <video id="video-player" controls autoplay></video>

    <script>
        // Изменяем базовый URL для запросов к бэкенду
        const BACKEND_URL = 'http://backend:8000'; // 'backend' - это имя сервиса в docker-compose

        document.addEventListener('DOMContentLoaded', fetchVideos);

        async function scanAndLoadVideos() {
            try {
                const response = await fetch(`${BACKEND_URL}/videos/scan-and-load/`, { method: 'POST' });
                const data = await response.json();
                alert(`Loaded/Updated ${data.length} videos.`);
                fetchVideos(); // Refresh the video list
            } catch (error) {
                console.error('Error scanning and loading videos:', error);
                alert('Error scanning and loading videos. Check console for details.');
            }
        }

        async function fetchVideos() {
            try {
                const response = await fetch(`${BACKEND_URL}/videos/`);
                const videos = await response.json();
                const videoListDiv = document.getElementById('video-list');
                videoListDiv.innerHTML = '';
                if (videos.length === 0) {
                    videoListDiv.innerHTML = '<p>No videos found. Click "Scan and Load Videos" to add them.</p>';
                } else {
                    videos.forEach(video => {
                        const videoItem = document.createElement('div');
                        videoItem.className = 'video-item';
                        videoItem.textContent = video.title;
                        videoItem.onclick = () => playVideo(video.id);
                        videoListDiv.appendChild(videoItem);
                    });
                }
            } catch (error) {
                console.error('Error fetching videos:', error);
            }
        }

        function playVideo(videoId) {
            const videoPlayer = document.getElementById('video-player');
            videoPlayer.src = `${BACKEND_URL}/videos/${videoId}/stream`;
            videoPlayer.load();
            videoPlayer.play();
        }

        async function searchVideos() {
            const query = document.getElementById('search-input').value;
            if (!query) {
                alert('Please enter a search query.');
                return;
            }
            try {
                const response = await fetch(`${BACKEND_URL}/search/?query=${encodeURIComponent(query)}`);
                const results = await response.json();
                const searchResultsDiv = document.getElementById('search-results');
                searchResultsDiv.innerHTML = '';
                if (results.length === 0) {
                    searchResultsDiv.innerHTML = '<p>No results found.</p>';
                } else {
                    results.forEach(result => {
                        const resultItem = document.createElement('div');
                        resultItem.className = 'search-result-item';
                        resultItem.innerHTML = `
                            <h3>${result.title}</h3>
                            <p>${result.snippet || 'No snippet available.'}</p>
                            <button onclick="playVideo(${result.id})">Play Video</button>
                        `;
                        searchResultsDiv.appendChild(resultItem);
                    });
                }
            } catch (error) {
                console.error('Error searching videos:', error);
            }
        }
    </script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #video-list { margin-top: 20px; }
        .video-item { margin-bottom: 10px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; cursor: pointer; }
        .video-item:hover { background-color: #f0f0f0; }
        video { max-width: 100%; height: auto; display: block; margin-top: 20px; }
        #search-results { margin-top: 20px; }
        .search-result-item { margin-bottom: 10px; padding: 10px; border: 1px solid #eee; border-radius: 5px; }
        .highlight { background-color: yellow; }
    </style>
</body>
</html>